<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Image Color Converter</title>
  <style>
    * { box-sizing: border-box; }

    body {
      font-family: system-ui, -apple-system, sans-serif;
      max-width: 1000px;
      margin: 0 auto;
      padding: 20px;
      background: #1a1a2e;
      color: #eee;
      min-height: 100vh;
    }

    h1 {
      text-align: center;
      color: #fff;
      margin-bottom: 10px;
    }

    .subtitle {
      text-align: center;
      color: #888;
      margin-bottom: 30px;
    }

    .drop-zone {
      border: 3px dashed #444;
      border-radius: 12px;
      padding: 40px;
      text-align: center;
      cursor: pointer;
      transition: all 0.3s ease;
      background: #16213e;
      margin-bottom: 20px;
    }

    .drop-zone:hover, .drop-zone.dragover {
      border-color: #667eea;
      background: #1a2744;
    }

    .drop-zone input {
      display: none;
    }

    .drop-zone p {
      margin: 0;
      color: #888;
    }

    .drop-zone .icon {
      font-size: 48px;
      margin-bottom: 10px;
    }

    .controls {
      background: #16213e;
      padding: 20px;
      border-radius: 12px;
      margin-bottom: 20px;
    }

    .mode-toggle {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
    }

    .mode-btn {
      flex: 1;
      padding: 12px 20px;
      border: 2px solid #444;
      background: transparent;
      color: #888;
      border-radius: 8px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 500;
      transition: all 0.2s;
    }

    .mode-btn:hover {
      border-color: #667eea;
      color: #fff;
    }

    .mode-btn.active {
      background: #667eea;
      border-color: #667eea;
      color: #fff;
    }

    .color-section {
      margin-bottom: 15px;
    }

    .color-section label {
      display: block;
      margin-bottom: 8px;
      color: #aaa;
      font-size: 14px;
    }

    .color-row {
      display: flex;
      gap: 10px;
      align-items: center;
      flex-wrap: wrap;
    }

    .color-input-wrapper {
      display: flex;
      align-items: center;
      gap: 8px;
      background: #1a1a2e;
      padding: 8px 12px;
      border-radius: 8px;
    }

    input[type="color"] {
      width: 40px;
      height: 40px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      background: none;
    }

    input[type="color"]::-webkit-color-swatch-wrapper {
      padding: 0;
    }

    input[type="color"]::-webkit-color-swatch {
      border: 2px solid #444;
      border-radius: 6px;
    }

    .color-hex {
      font-family: monospace;
      color: #fff;
      font-size: 14px;
    }

    .preset-colors {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }

    .preset-color {
      width: 32px;
      height: 32px;
      border-radius: 6px;
      border: 2px solid transparent;
      cursor: pointer;
      transition: all 0.2s;
    }

    .preset-color:hover {
      transform: scale(1.1);
      border-color: #fff;
    }

    .gradient-colors {
      display: none;
    }

    .gradient-colors.show {
      display: block;
    }

    .gradient-stops {
      display: flex;
      gap: 15px;
      flex-wrap: wrap;
    }

    .gradient-stop {
      display: flex;
      align-items: center;
      gap: 8px;
      background: #1a1a2e;
      padding: 8px 12px;
      border-radius: 8px;
    }

    .preview-container {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
      margin-bottom: 20px;
    }

    @media (max-width: 600px) {
      .preview-container {
        grid-template-columns: 1fr;
      }
    }

    .preview-box {
      background: #16213e;
      border-radius: 12px;
      padding: 15px;
      text-align: center;
    }

    .preview-box h3 {
      margin: 0 0 15px 0;
      color: #888;
      font-size: 14px;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .preview-box canvas {
      max-width: 100%;
      max-height: 300px;
      background: repeating-conic-gradient(#333 0% 25%, #222 0% 50%) 50% / 20px 20px;
      border-radius: 8px;
    }

    .actions {
      display: flex;
      gap: 10px;
      justify-content: center;
      flex-wrap: wrap;
    }

    button {
      padding: 12px 24px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 500;
      transition: all 0.2s;
    }

    .btn-primary {
      background: linear-gradient(135deg, #667eea, #764ba2);
      color: #fff;
    }

    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
    }

    .btn-secondary {
      background: #333;
      color: #fff;
    }

    .btn-secondary:hover {
      background: #444;
    }

    .option-row {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-top: 15px;
      color: #aaa;
      font-size: 14px;
    }

    .option-row input[type="checkbox"] {
      width: 18px;
      height: 18px;
      cursor: pointer;
    }

    .option-row input[type="range"] {
      flex: 1;
      max-width: 200px;
    }

    .hidden {
      display: none;
    }
  </style>
</head>
<body>
  <h1>Image Color Converter</h1>
  <p class="subtitle">Transform images into monochromatic or polychromatic versions</p>

  <div class="drop-zone" id="dropZone">
    <div class="icon">üñºÔ∏è</div>
    <p>Drop an image here or click to upload</p>
    <input type="file" id="fileInput" accept="image/*">
  </div>

  <div class="controls">
    <div class="mode-toggle">
      <button class="mode-btn active" data-mode="mono">Monochromatic</button>
      <button class="mode-btn" data-mode="duo">Duotone</button>
      <button class="mode-btn" data-mode="gradient">Gradient Map</button>
    </div>

    <div class="color-section" id="monoSection">
      <label>Color</label>
      <div class="color-row">
        <div class="color-input-wrapper">
          <input type="color" id="monoColor" value="#667eea">
          <span class="color-hex" id="monoHex">#667eea</span>
        </div>
        <div class="preset-colors">
          <div class="preset-color" style="background: #667eea" data-color="#667eea"></div>
          <div class="preset-color" style="background: #f093fb" data-color="#f093fb"></div>
          <div class="preset-color" style="background: #4facfe" data-color="#4facfe"></div>
          <div class="preset-color" style="background: #43e97b" data-color="#43e97b"></div>
          <div class="preset-color" style="background: #fa709a" data-color="#fa709a"></div>
          <div class="preset-color" style="background: #ffecd2" data-color="#ffecd2"></div>
          <div class="preset-color" style="background: #a8edea" data-color="#a8edea"></div>
          <div class="preset-color" style="background: #ffffff" data-color="#ffffff"></div>
        </div>
      </div>
    </div>

    <div class="color-section hidden" id="duoSection">
      <label>Shadow Color (Dark areas)</label>
      <div class="color-row" style="margin-bottom: 15px;">
        <div class="color-input-wrapper">
          <input type="color" id="duoShadow" value="#1a1a2e">
          <span class="color-hex" id="duoShadowHex">#1a1a2e</span>
        </div>
      </div>
      <label>Highlight Color (Light areas)</label>
      <div class="color-row">
        <div class="color-input-wrapper">
          <input type="color" id="duoHighlight" value="#667eea">
          <span class="color-hex" id="duoHighlightHex">#667eea</span>
        </div>
      </div>
    </div>

    <div class="color-section hidden" id="gradientSection">
      <label>Gradient Stops (Maps luminosity to colors)</label>
      <div class="gradient-stops">
        <div class="gradient-stop">
          <span>0%</span>
          <input type="color" id="grad0" value="#1a1a2e">
        </div>
        <div class="gradient-stop">
          <span>33%</span>
          <input type="color" id="grad33" value="#764ba2">
        </div>
        <div class="gradient-stop">
          <span>66%</span>
          <input type="color" id="grad66" value="#667eea">
        </div>
        <div class="gradient-stop">
          <span>100%</span>
          <input type="color" id="grad100" value="#f093fb">
        </div>
      </div>
    </div>

    <div class="option-row">
      <input type="checkbox" id="preserveAlpha" checked>
      <label for="preserveAlpha">Preserve transparency</label>
    </div>

    <div class="option-row">
      <label for="intensity">Intensity:</label>
      <input type="range" id="intensity" min="0" max="100" value="100">
      <span id="intensityValue">100%</span>
    </div>
  </div>

  <div class="preview-container">
    <div class="preview-box">
      <h3>Original</h3>
      <canvas id="originalCanvas"></canvas>
    </div>
    <div class="preview-box">
      <h3>Converted</h3>
      <canvas id="convertedCanvas"></canvas>
    </div>
  </div>

  <div class="actions">
    <button class="btn-primary" id="downloadBtn">Download PNG</button>
    <button class="btn-secondary" id="downloadSvgBtn">Download SVG</button>
    <button class="btn-secondary" id="resetBtn">Reset</button>
  </div>

  <script>
    const dropZone = document.getElementById('dropZone');
    const fileInput = document.getElementById('fileInput');
    const originalCanvas = document.getElementById('originalCanvas');
    const convertedCanvas = document.getElementById('convertedCanvas');
    const originalCtx = originalCanvas.getContext('2d');
    const convertedCtx = convertedCanvas.getContext('2d');

    let originalImage = null;
    let originalImageData = null;
    let currentMode = 'mono';

    // Mode switching
    document.querySelectorAll('.mode-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        document.querySelectorAll('.mode-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        currentMode = btn.dataset.mode;

        document.getElementById('monoSection').classList.toggle('hidden', currentMode !== 'mono');
        document.getElementById('duoSection').classList.toggle('hidden', currentMode !== 'duo');
        document.getElementById('gradientSection').classList.toggle('hidden', currentMode !== 'gradient');

        processImage();
      });
    });

    // Color input updates
    document.getElementById('monoColor').addEventListener('input', (e) => {
      document.getElementById('monoHex').textContent = e.target.value;
      processImage();
    });

    document.getElementById('duoShadow').addEventListener('input', (e) => {
      document.getElementById('duoShadowHex').textContent = e.target.value;
      processImage();
    });

    document.getElementById('duoHighlight').addEventListener('input', (e) => {
      document.getElementById('duoHighlightHex').textContent = e.target.value;
      processImage();
    });

    ['grad0', 'grad33', 'grad66', 'grad100'].forEach(id => {
      document.getElementById(id).addEventListener('input', processImage);
    });

    // Preset colors
    document.querySelectorAll('.preset-color').forEach(preset => {
      preset.addEventListener('click', () => {
        const color = preset.dataset.color;
        document.getElementById('monoColor').value = color;
        document.getElementById('monoHex').textContent = color;
        processImage();
      });
    });

    // Options
    document.getElementById('preserveAlpha').addEventListener('change', processImage);
    document.getElementById('intensity').addEventListener('input', (e) => {
      document.getElementById('intensityValue').textContent = e.target.value + '%';
      processImage();
    });

    // File handling
    dropZone.addEventListener('click', () => fileInput.click());

    dropZone.addEventListener('dragover', (e) => {
      e.preventDefault();
      dropZone.classList.add('dragover');
    });

    dropZone.addEventListener('dragleave', () => {
      dropZone.classList.remove('dragover');
    });

    dropZone.addEventListener('drop', (e) => {
      e.preventDefault();
      dropZone.classList.remove('dragover');
      if (e.dataTransfer.files.length) {
        loadImage(e.dataTransfer.files[0]);
      }
    });

    fileInput.addEventListener('change', (e) => {
      if (e.target.files.length) {
        loadImage(e.target.files[0]);
      }
    });

    function loadImage(file) {
      const reader = new FileReader();
      reader.onload = (e) => {
        const img = new Image();
        img.onload = () => {
          originalImage = img;

          originalCanvas.width = img.width;
          originalCanvas.height = img.height;
          convertedCanvas.width = img.width;
          convertedCanvas.height = img.height;

          originalCtx.drawImage(img, 0, 0);
          originalImageData = originalCtx.getImageData(0, 0, img.width, img.height);

          processImage();
        };
        img.src = e.target.result;
      };
      reader.readAsDataURL(file);
    }

    function hexToRgb(hex) {
      const result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
      return result ? {
        r: parseInt(result[1], 16),
        g: parseInt(result[2], 16),
        b: parseInt(result[3], 16)
      } : null;
    }

    function getLuminosity(r, g, b) {
      return (0.299 * r + 0.587 * g + 0.114 * b) / 255;
    }

    function lerp(a, b, t) {
      return a + (b - a) * t;
    }

    function lerpColor(c1, c2, t) {
      return {
        r: Math.round(lerp(c1.r, c2.r, t)),
        g: Math.round(lerp(c1.g, c2.g, t)),
        b: Math.round(lerp(c1.b, c2.b, t))
      };
    }

    function processImage() {
      if (!originalImageData) return;

      const data = new Uint8ClampedArray(originalImageData.data);
      const preserveAlpha = document.getElementById('preserveAlpha').checked;
      const intensity = document.getElementById('intensity').value / 100;

      for (let i = 0; i < data.length; i += 4) {
        const r = data[i];
        const g = data[i + 1];
        const b = data[i + 2];
        const a = data[i + 3];

        const lum = getLuminosity(r, g, b);
        let newColor;

        if (currentMode === 'mono') {
          const color = hexToRgb(document.getElementById('monoColor').value);
          newColor = {
            r: Math.round(color.r * lum),
            g: Math.round(color.g * lum),
            b: Math.round(color.b * lum)
          };
        } else if (currentMode === 'duo') {
          const shadow = hexToRgb(document.getElementById('duoShadow').value);
          const highlight = hexToRgb(document.getElementById('duoHighlight').value);
          newColor = lerpColor(shadow, highlight, lum);
        } else if (currentMode === 'gradient') {
          const c0 = hexToRgb(document.getElementById('grad0').value);
          const c33 = hexToRgb(document.getElementById('grad33').value);
          const c66 = hexToRgb(document.getElementById('grad66').value);
          const c100 = hexToRgb(document.getElementById('grad100').value);

          if (lum < 0.33) {
            newColor = lerpColor(c0, c33, lum / 0.33);
          } else if (lum < 0.66) {
            newColor = lerpColor(c33, c66, (lum - 0.33) / 0.33);
          } else {
            newColor = lerpColor(c66, c100, (lum - 0.66) / 0.34);
          }
        }

        // Apply intensity (blend with original)
        data[i] = Math.round(lerp(r, newColor.r, intensity));
        data[i + 1] = Math.round(lerp(g, newColor.g, intensity));
        data[i + 2] = Math.round(lerp(b, newColor.b, intensity));

        if (!preserveAlpha) {
          data[i + 3] = 255;
        }
      }

      const imageData = new ImageData(data, originalImageData.width, originalImageData.height);
      convertedCtx.putImageData(imageData, 0, 0);
    }

    // Download buttons
    document.getElementById('downloadBtn').addEventListener('click', () => {
      if (!originalImage) return;

      const link = document.createElement('a');
      link.download = 'converted-image.png';
      link.href = convertedCanvas.toDataURL('image/png');
      link.click();
    });

    document.getElementById('downloadSvgBtn').addEventListener('click', () => {
      if (!originalImage) return;

      const dataUrl = convertedCanvas.toDataURL('image/png');
      const svg = `<svg xmlns="http://www.w3.org/2000/svg" width="${convertedCanvas.width}" height="${convertedCanvas.height}">
        <image href="${dataUrl}" width="${convertedCanvas.width}" height="${convertedCanvas.height}"/>
      </svg>`;

      const blob = new Blob([svg], { type: 'image/svg+xml' });
      const link = document.createElement('a');
      link.download = 'converted-image.svg';
      link.href = URL.createObjectURL(blob);
      link.click();
    });

    document.getElementById('resetBtn').addEventListener('click', () => {
      originalImage = null;
      originalImageData = null;
      originalCtx.clearRect(0, 0, originalCanvas.width, originalCanvas.height);
      convertedCtx.clearRect(0, 0, convertedCanvas.width, convertedCanvas.height);
      originalCanvas.width = 300;
      originalCanvas.height = 150;
      convertedCanvas.width = 300;
      convertedCanvas.height = 150;
    });

    // Demo image on load
    const demoCanvas = document.createElement('canvas');
    demoCanvas.width = 200;
    demoCanvas.height = 200;
    const demoCtx = demoCanvas.getContext('2d');

    // Create a gradient demo image
    const gradient = demoCtx.createRadialGradient(100, 100, 10, 100, 100, 90);
    gradient.addColorStop(0, '#fff');
    gradient.addColorStop(0.5, '#888');
    gradient.addColorStop(1, '#000');
    demoCtx.fillStyle = gradient;
    demoCtx.beginPath();
    demoCtx.arc(100, 100, 90, 0, Math.PI * 2);
    demoCtx.fill();

    // Load demo
    const demoImg = new Image();
    demoImg.onload = () => {
      originalImage = demoImg;
      originalCanvas.width = demoImg.width;
      originalCanvas.height = demoImg.height;
      convertedCanvas.width = demoImg.width;
      convertedCanvas.height = demoImg.height;
      originalCtx.drawImage(demoImg, 0, 0);
      originalImageData = originalCtx.getImageData(0, 0, demoImg.width, demoImg.height);
      processImage();
    };
    demoImg.src = demoCanvas.toDataURL();
  </script>
</body>
</html>
